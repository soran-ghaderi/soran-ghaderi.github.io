/* =====================================================
   SYNTAX HIGHLIGHTING - Rouge (Server-side, GitHub Pages compatible)
   
   Rouge is Jekyll's built-in syntax highlighter that runs at build time.
   This ensures code blocks are properly highlighted without relying on 
   client-side JavaScript that can fail on GitHub Pages.
   
   CSS handles both light and dark themes via .dark class.
   ===================================================== */

/* All pre blocks - baseline styling with responsive improvements */
pre {
  display: block;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  margin: 1.5rem 0;
  padding: 1rem 1.25rem;
  border-radius: 0.5rem;
  border: 1px solid var(--pre-border);
  background-color: var(--pre-bg);
  max-width: 100%;
  
  /* Responsive padding */
  @media (max-width: 768px) {
    margin: 1rem 0;
    padding: 0.75rem 1rem;
    border-radius: 0.375rem;
    font-size: 0.85rem;
  }
  
  @media (max-width: 480px) {
    margin: 0.75rem 0;
    padding: 0.625rem 0.75rem;
    font-size: 0.8rem;
  }
  
  /* Scrollbar styling for mobile */
  &::-webkit-scrollbar {
    height: 4px;
  }
  
  &::-webkit-scrollbar-track {
    background: transparent;
  }
  
  &::-webkit-scrollbar-thumb {
    background: var(--text-muted, #888);
    border-radius: 2px;
  }
  
  code {
    font-family: var(--code-font-family);
    font-size: var(--code-font-size);
    background: transparent;
    padding: 0;
    border: none;
    color: var(--pre-code-color);
    white-space: pre;
    word-wrap: normal;
  }
}

/* Rouge/Jekyll highlighter wrapper */
.highlighter-rouge {
  margin: 1.5rem 0;
  
  .highlight {
    margin: 0;
    padding: 0;
    border-radius: 0.5rem;
    overflow: hidden;
    background-color: var(--pre-bg);
  }
  
  pre.highlight {
    margin: 0;
    padding: 1rem 1.25rem;
    border: 1px solid var(--pre-border);
    background-color: var(--pre-bg);
  }
}

/* =====================================================
   CODE BLOCK WRAPPER WITH COPY BUTTON
   Provides a wrapper for code blocks with a floating
   copy button icon in the top-right corner
   ===================================================== */

.code-block-wrapper {
  position: relative;
  margin: 1.5rem 0;
  background-color: var(--pre-bg);
  border-radius: 0.5rem;
  border: 1px solid var(--pre-border);
  overflow: hidden;
  
  /* Remove margin and border from contained elements since wrapper handles it */
  .highlighter-rouge,
  pre.shiki,
  figure.highlight {
    margin: 0;
  }
  
  .highlighter-rouge .highlight,
  .highlighter-rouge pre.highlight,
  pre.highlight {
    border: none;
    border-radius: 0;
  }
}

/* Copy button - icon style similar to Claude */
.copy-button {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: none;
  border-radius: 6px;
  background-color: rgba(255, 255, 255, 0.1);
  color: var(--pre-code-color, #e1e4e8);
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.2s ease, background-color 0.2s ease;
  
  svg {
    width: 16px;
    height: 16px;
    pointer-events: none;
  }
  
  &:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }
  
  &:active {
    background-color: rgba(255, 255, 255, 0.25);
  }
  
  &.copied {
    color: #85e89d;
    background-color: rgba(133, 232, 157, 0.15);
  }
}

/* Show copy button on hover */
.code-block-wrapper:hover .copy-button {
  opacity: 1;
}

/* Light mode adjustments */
body:not(.dark) .copy-button,
html:not(.dark) .copy-button {
  background-color: rgba(0, 0, 0, 0.05);
  color: var(--pre-code-color, #24292e);
  
  &:hover {
    background-color: rgba(0, 0, 0, 0.1);
  }
  
  &:active {
    background-color: rgba(0, 0, 0, 0.15);
  }
  
  &.copied {
    color: #22863a;
    background-color: rgba(34, 134, 58, 0.1);
  }
}

/* Inline code (not inside pre blocks) - responsive word breaking */
:not(pre) > code {
  background-color: var(--code-bg);
  padding: 0.2em 0.4em;
  border-radius: 4px;
  font-family: var(--code-font-family);
  font-size: var(--code-font-size);
  color: var(--code-color);
  /* Allow wrapping on small screens */
  white-space: normal;
  word-wrap: break-word;
  word-break: break-word;
  
  @media (min-width: 769px) {
    /* Prefer no-wrap on desktop unless forced */
    white-space: nowrap;
    word-wrap: normal;
    word-break: normal;
  }
}

/* Allow wrapping for longer inline code */
:not(pre) > code.wrap {
  white-space: normal;
  word-wrap: break-word;
}

/* =====================================================
   ROUGE SYNTAX TOKENS
   Uses CSS variables from base.scss for light/dark theming
   ===================================================== */

/* Base text color in code blocks */
.highlight {
  color: var(--syntax-text);
  background-color: var(--pre-bg);
}

/* Comments */
.highlight .c,   /* Comment */
.highlight .c1,  /* Comment.Single */
.highlight .cm,  /* Comment.Multiline */
.highlight .cs,  /* Comment.Special */
.highlight .cp   /* Comment.Preproc */
{
  color: var(--syntax-comment);
  font-style: italic;
}

/* Strings */
.highlight .s,   /* String */
.highlight .s1,  /* String.Single */
.highlight .s2,  /* String.Double */
.highlight .sb,  /* String.Backtick */
.highlight .sc,  /* String.Char */
.highlight .sd,  /* String.Doc */
.highlight .se,  /* String.Escape */
.highlight .sh,  /* String.Heredoc */
.highlight .si,  /* String.Interpol */
.highlight .sr,  /* String.Regex */
.highlight .ss,  /* String.Symbol */
.highlight .sx   /* String.Other */
{
  color: var(--syntax-string);
}

/* Numbers */
.highlight .m,   /* Number */
.highlight .mf,  /* Number.Float */
.highlight .mh,  /* Number.Hex */
.highlight .mi,  /* Number.Integer */
.highlight .mo,  /* Number.Oct */
.highlight .mb,  /* Number.Bin */
.highlight .il   /* Number.Integer.Long */
{
  color: var(--syntax-number);
}

/* Keywords */
.highlight .k,   /* Keyword */
.highlight .kc,  /* Keyword.Constant */
.highlight .kd,  /* Keyword.Declaration */
.highlight .kn,  /* Keyword.Namespace */
.highlight .kp,  /* Keyword.Pseudo */
.highlight .kr,  /* Keyword.Reserved */
.highlight .kt   /* Keyword.Type */
{
  color: var(--syntax-keyword);
}

/* Operators */
.highlight .o,   /* Operator */
.highlight .ow   /* Operator.Word */
{
  color: var(--syntax-keyword);
}

/* Names/Identifiers */
.highlight .n,   /* Name */
.highlight .na,  /* Name.Attribute */
.highlight .ni,  /* Name.Entity */
.highlight .nl,  /* Name.Label */
.highlight .nn,  /* Name.Namespace */
.highlight .nt,  /* Name.Tag */
.highlight .nv,  /* Name.Variable */
.highlight .bp,  /* Name.Builtin.Pseudo */
.highlight .vc,  /* Name.Variable.Class */
.highlight .vg,  /* Name.Variable.Global */
.highlight .vi   /* Name.Variable.Instance */
{
  color: var(--syntax-text);
}

/* Function names - special highlight */
.highlight .nf,  /* Name.Function */
.highlight .fm   /* Name.Function.Magic */
{
  color: var(--syntax-function);
}

/* Class names */
.highlight .nc   /* Name.Class */
{
  color: var(--syntax-class);
}

/* Decorators */
.highlight .nd   /* Name.Decorator */
{
  color: var(--syntax-function);
}

/* Builtins */
.highlight .nb,  /* Name.Builtin */
.highlight .ne   /* Name.Exception */
{
  color: var(--syntax-class);
}

/* Constants */
.highlight .no   /* Name.Constant */
{
  color: var(--syntax-class);
}

/* Punctuation */
.highlight .p    /* Punctuation */
{
  color: var(--syntax-punctuation);
}

/* Generic styles */
.highlight .ge   /* Generic.Emph */
{
  font-style: italic;
}

.highlight .gs   /* Generic.Strong */
{
  font-weight: bold;
}

.highlight .gd   /* Generic.Deleted */
{
  color: var(--syntax-deleted);
  background-color: rgba(249, 117, 131, 0.1);
}

.highlight .gi   /* Generic.Inserted */
{
  color: var(--syntax-inserted);
  background-color: rgba(133, 232, 157, 0.1);
}

.highlight .gh   /* Generic.Heading */
{
  color: var(--syntax-class);
  font-weight: bold;
}

.highlight .gu   /* Generic.Subheading */
{
  color: var(--syntax-inserted);
  font-weight: bold;
}

/* Error */
.highlight .err  /* Error */
{
  color: var(--syntax-deleted);
}

/* =====================================================
   LEGACY SHIKI SUPPORT (for any remaining Shiki blocks)
   ===================================================== */

/* Shiki-processed code blocks */
pre.shiki,
pre[class*="shiki"],
pre[data-shiki-done="true"] {
  code {
    font-family: var(--code-font-family);
    font-size: var(--code-font-size);
    background: transparent;
    padding: 0;
    border: none;
  }
}

/* Dark mode: switch to Shiki's --shiki-dark-* CSS variables */
.dark .shiki,
html.dark .shiki,
body.dark .shiki {
  background-color: var(--shiki-dark-bg, var(--pre-bg)) !important;
}

.dark .shiki span,
html.dark .shiki span,
body.dark .shiki span {
  color: var(--shiki-dark) !important;
  background-color: transparent !important;
}
